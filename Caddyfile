{
    # Security: Disable the admin API
    admin off
}

# Strictly listen on Port 80 (HTTP)
:80 {
    # 1. Health check (Public)
    handle /health {
        reverse_proxy bifrost:8080
    }

    # 2. LLM Interactions (Public - Protected by Bifrost Virtual Keys)
    handle /v1* {
        reverse_proxy bifrost:8080
    }

    # 3. Admin & Governance (Secured by Caddy Basic Auth)
    handle {
        basic_auth {
            {$ADMIN_USER} {$ADMIN_PASS_HASH}
        }
        reverse_proxy bifrost:8080 {
            header_up Host {host}
            header_up X-Real-IP {remote}
        }
    }

    log {
        output file /var/log/caddy/access.log
        format json
    }
}